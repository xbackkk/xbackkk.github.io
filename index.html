<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V5</title>
  <style>
    .btn {
      padding: 5px 15px;
      height: 25px;
      line-height: 25px;
      text-align: center;
      background-color: #e7e4e4;
      border: 1px solid #e3d8d8;
      border-radius: 10px;
      font-size: 15px;
    }
    /* 筛选球 */

    .redball,.blueball {
      height: 25px;
      width: 25px;
      border-radius: 50%;
      color: #fff;
      text-align: center;
      line-height: 25px;
      display: inline-block;
      font-size: 12px;
      margin: 5px;
      background-color: #938b8b;
    }


    /* 生成球 */
    .big-ball {
      height: 30px;
      width: 30px;
      border-radius: 50%;
      color: #fff;
      text-align: center;
      line-height: 30px;
      display: inline-block;
      font-size: 14px;
      margin: 5px;
      background-color: #938b8b;
    }

    .input-ball{
      height: 25px;
      width: 25px;
      border-radius: 50%;
      color: #fff;
      text-align: center;
      line-height: 25px;
      display: inline-block;
      font-size: 12px;
      margin: 5px;
      background-color: #938b8b;
    }

    #condition{
      max-width: 600px; 
      margin: auto; 
      /* display: none; */
    }
    #result{
      max-width: 600px;
      margin: auto;
    }
    
    .red {
      background-color: red;
    }
    .blue {
      background-color: blue;
    }
    .disabled {
      /* background-color: #938b8b; */
      background-color: #272727;
    }
    .lucky {
      background-color: red;
    }

    .delete {
      color: blue;
    }
    .clickcolor{
      background-color:#b9b0b0;
    }
    .none{
      display: none;
    }
    .flex{
      display: flex;
    }
    .small-btn {
      display: inline-block;
      font-size: 12px;
    }
    /* 生成球居中样式 */
    .b{
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #message {
      box-shadow: 0 2px 4px rgba(0,0,0,.12),0 0 6px rgba(0,0,0,.04);
      width: 40vw;
      padding: 8px 15px;
      border-radius: 5px;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0,0,0,0.5);
      color: #fff;
      transition: opacity .3s,transform .4s;
      overflow: hidden;
      text-align: center;
      z-index: 2001;
    }
    #input{
      position: absolute;
      top: 45%;
      transform: translate(0, -50%);
      background-color: #dfd9d9;
      padding: 25px 0;
      border-radius: 10px;
    }
    /* 蒙层样式 */
    .a{
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: rgba(0,0,0,0.5);
    }

  </style>
</head>
<body>
  <div class="buttoncontainer" style="display: flex;">
    <div class="btn" id="required" style="flex: 1;">必选</div>
    <div class="btn" id="exclude" style="flex: 1;">禁止选取</div>
  </div>
  
  <div id="condition">
    <div id= "list" class="none">
      <div id="redlist"style="flex:2;">
      </div>
      <div id="bluelist" style="flex:1;margin-left: 10px;">
      </div>
    </div>
  </div>

  <div class="btn" id="rand" style="margin: 20px 0;">随机生成</div>
  <div id="result"></div>
  <div style="margin-top:10px;">
    <div class="btn small-btn" id="save">保存</div>
  </div>

  <div style="margin-top: 20px; display: flex;">

    <div class="btn" id="inprtWinning" style="flex: 1;">输入中奖号码</div>
    <div class="btn" id="showPreResult" style="flex: 1;">历史号码</div>
    <div class="btn" id="confirm" style="flex: 1;">判断命中号码</div>

    <div class="none a" id="input-wrap">
      <div id="input" style="max-width: 600px;margin: auto;">

        <div style="display: flex;">
          <div style="flex: 2;">
            <span class="input-ball b1" data-value="1">1</span>
            <span class="input-ball b1" data-value="2">2</span>
            <span class="input-ball b1" data-value="3">3</span>
            <span class="input-ball b1" data-value="4">4</span>
            <span class="input-ball b1" data-value="5">5</span>
            <span class="input-ball b1" data-value="6">6</span>
            <span class="input-ball b1" data-value="7">7</span>
            <span class="input-ball b1" data-value="8">8</span>
            <span class="input-ball b1" data-value="9">9</span>
            <span class="input-ball b1" data-value="10">10</span>
            <span class="input-ball b1" data-value="11">11</span>
            <span class="input-ball b1" data-value="12">12</span>
            <span class="input-ball b1" data-value="13">13</span>
            <span class="input-ball b1" data-value="14">14</span>
            <span class="input-ball b1" data-value="15">15</span>
            <span class="input-ball b1" data-value="16">16</span>
            <span class="input-ball b1" data-value="17">17</span>
            <span class="input-ball b1" data-value="18">18</span>
            <span class="input-ball b1" data-value="19">19</span>
            <span class="input-ball b1" data-value="20">20</span>
            <span class="input-ball b1" data-value="21">21</span>
            <span class="input-ball b1" data-value="22">22</span>
            <span class="input-ball b1" data-value="23">23</span>
            <span class="input-ball b1" data-value="25">25</span>
            <span class="input-ball b1" data-value="26">26</span>
            <span class="input-ball b1" data-value="27">27</span>
            <span class="input-ball b1" data-value="28">28</span>
            <span class="input-ball b1" data-value="29">29</span>
            <span class="input-ball b1" data-value="30">30</span>
            <span class="input-ball b1" data-value="31">31</span>
            <span class="input-ball b1" data-value="32">32</span>
            <span class="input-ball b1" data-value="33">33</span>
          </div>
          <div style="flex: 1;">
            <span class="input-ball b2" data-value="1">1</span>
            <span class="input-ball b2" data-value="2">2</span>
            <span class="input-ball b2" data-value="3">3</span>
            <span class="input-ball b2" data-value="4">4</span>
            <span class="input-ball b2" data-value="5">5</span>
            <span class="input-ball b2" data-value="6">6</span>
            <span class="input-ball b2" data-value="7">7</span>
            <span class="input-ball b2" data-value="8">8</span>
            <span class="input-ball b2" data-value="9">9</span>
            <span class="input-ball b2" data-value="10">10</span>
            <span class="input-ball b2" data-value="11">11</span>
            <span class="input-ball b2" data-value="12">12</span>
            <span class="input-ball b2" data-value="13">13</span>
            <span class="input-ball b2" data-value="14">14</span>
            <span class="input-ball b2" data-value="15">15</span>
            <span class="input-ball b2" data-value="16">16</span>
          </div>
        </div>

        <div style="margin-top:10px;">
          <div class="small-btn btn" id="saveWinning">保存</div>
          <div class="small-btn btn" id="cancelWinning">取消</div>
          <div class="small-btn btn" id="showWinning">历史中奖号码</div>
        </div>

      </div>
    </div>
  </div>
  <div id="buy-result" class="none">
    <div class="b" style="margin: 10px 0 0 0;">中奖号码</div>
    <div id="nowin"></div>
    <!-- <div class="b none" style="margin: 10px 0 0 0;">历史中奖号码</div> -->
    <div id="oldwin"></div>
    <div class="b" style="margin: 10px 0 0 0;">上期购买号码</div>
    <div id="buy"></div>
  </div>
  <script>

   // 通用方法
   let utifunction = {
      //initpages使用：判断有无类名，没有增加，有则删除；参数1：元素，元素2：类名
      addClass:function(ele,str){
        if(ele.classList.contains(str)){
          ele.classList.remove(str)
        }else{
          ele.classList.add(str)
        }
      },
      listaddClass:function(eles,str){
        for (var i = 0; i < eles.length; i++) {
          eles[i].addEventListener('click',function(e){
            utifunction.addClass(e.target,str)
          })
        }
      },
      //initpages使用：为list的每个元素添加事件监听器,控制classlist变化
      addlis:function(divs,str,str2){
        // console.log(divs)
        for (var i = 0; i < divs.length; i++) {
          divs[i].addEventListener('click', function(e) {
            if(element.required.classList.contains('clickcolor')){
              e.target.classList.remove('disabled')
              utifunction.addClass(e.target,str)
            }else{
              e.target.classList.remove('red')
              e.target.classList.remove('blue')
              utifunction.addClass(e.target,str2)
            }
            
          })
        }
      },
      //createball使用：函数：生成n-m区间的号码
      getRandom : function(n,m){
        return Math.floor(Math.random()*(m - n + 1 ) + n)
      },
      //createball使用：函数：在数组1中：去除在数组2冲出出现的元素
      wipeoff:function(arr1,arr2){
        for(let i = 0 ;i< arr2.length;i++){
          let num = arr1.indexOf(arr2[i])
          if (num !== -1){
            arr1.splice(num,1)
          }
        }
        // return arr1
      },
      //createball使用：函数：获取筛选元素value
      getValue:function(str){
        const valueObj = document.querySelectorAll(str)
        let valueArr = []
        for (let i = 0 ; i < valueObj.length ; i ++ ){
          valueArr.push(+valueObj[i].innerText)
        }
        return valueArr
      },
      randBall:function(arr){
      // console.log(bossarr)
        const tempArr = arr.map(function (ele,index) {
          return `
          <div class="b">
            <span class="big-ball red">${ele[0]}</span>
            <span class="big-ball red">${ele[1]}</span>
            <span class="big-ball red">${ele[2]}</span>
            <span class="big-ball red">${ele[3]}</span>
            <span class="big-ball red">${ele[4]}</span>
            <span class="big-ball red">${ele[5]}</span>
            <span class="big-ball blue" style="margin-left:10px">${ele[6]}</span>
            <span class="delete" data-value="${index}">删除</span>
          </div>
          `
        })

        // console.log(tempArr)
        // console.log(tempArr.join())
        element.result.innerHTML = tempArr.join('')
      },
      showball:function(elem,arr){
        const tempArr = arr.map(function (ele,index) {
          return `
          <div class="b">
            <span class="big-ball r">${ele[0]}</span>
            <span class="big-ball r">${ele[1]}</span>
            <span class="big-ball r">${ele[2]}</span>
            <span class="big-ball r">${ele[3]}</span>
            <span class="big-ball r">${ele[4]}</span>
            <span class="big-ball r">${ele[5]}</span>
            <span class="big-ball bl" style="margin-left:10px">${ele[6]}</span>
          </div>
          `
        })
        elem.innerHTML = tempArr.join('')
      },
      showin:function(elem,arr){
        const tempArr = arr.map(function (ele,index) {
          return `
          <div class="b">
            <span class="big-ball red">${ele[0]}</span>
            <span class="big-ball red">${ele[1]}</span>
            <span class="big-ball red">${ele[2]}</span>
            <span class="big-ball red">${ele[3]}</span>
            <span class="big-ball red">${ele[4]}</span>
            <span class="big-ball red">${ele[5]}</span>
            <span class="big-ball blue" style="margin-left:10px">${ele[6]}</span>
          </div>
          `
        })
        elem.innerHTML = tempArr.join('')
      },
      showoldwin:function(elem,arr){
        const tempArr = arr.map(function (ele,index) {
          return `
          <div class="b">
            <span class="big-ball">${ele[0]}</span>
            <span class="big-ball">${ele[1]}</span>
            <span class="big-ball">${ele[2]}</span>
            <span class="big-ball">${ele[3]}</span>
            <span class="big-ball">${ele[4]}</span>
            <span class="big-ball">${ele[5]}</span>
            <span class="big-ball" style="margin-left:10px">${ele[6]}</span>
          </div>
          `
        })
        elem.innerHTML = tempArr.join('')
      },

      
      showMessage:function (message) {
        var newElement = document.createElement('div')
        newElement.setAttribute('id', 'message')
        newElement.innerHTML = message
        document.body.appendChild(newElement)
        
        setTimeout(function() {
          document.body.removeChild(newElement);
        },2000)
      }

    }

    // 元素获取
    let element = {
      buttoncontainer:document.querySelector('.buttoncontainer'),
      exclude : document.querySelector('#exclude'),
      required : document.querySelector('#required'),
      list : document.querySelector('#list'),
      rand : document.querySelector('#rand'),
      result : document.querySelector('#result'),
      redlist : document.querySelector('#redlist'),
      bluelist : document.querySelector('#bluelist'),
      save : document.querySelector('#save'),
      inprtWinning : document.querySelector('#inprtWinning'),
      showPreResult : document.querySelector('#showPreResult'),
      confirm : document.querySelector('#confirm'),
      input : document.querySelector('#input-wrap'),
      cancelWinning : document.querySelector('#cancelWinning'),
      buyresult : document.querySelector("#buy-result"),
      buy : document.querySelector('#buy'),
      nowin:document.querySelector('#nowin'),
      oldwin:document.querySelector('#oldwin'),
      ipnutredball : document.querySelectorAll('.b1'),
      ipnutblueball : document.querySelectorAll('.b2'),
      saveWinning:document.querySelector('#saveWinning'),
      showWinning:document.querySelector('#showWinning')
    }
    
    // 生成条件框，点击可以展示/隐藏条件框，默认不可见
    let initpage = {
      redarr : [],
      bluarr : [],
      randarr : [],
      addball : function(){
        for(let i = 1; i < 34 ; i++){
          initpage.redarr.push (`<span class="redball" data-value="${i}">${i}</span>`)
          element.redlist.innerHTML = initpage.redarr.join('')
        }
        for(let j = 1; j < 17 ; j++){
          initpage.bluarr.push (`<span class="blueball" data-value="${j}">${j}</span>`)
          element.bluelist.innerHTML = initpage.bluarr.join('')
        }
      },
      // 根据选择显示按钮
      controlrequired : element.required.addEventListener('click',function(){
        if(element.exclude.classList.contains('clickcolor')){
          element.list.classList.add('flex')
        }else{
          utifunction.addClass(element.list,'flex')
        }
        element.exclude.classList.remove('clickcolor')
        element.required.classList.add('clickcolor')
      }),
      controlexclude : element.exclude.addEventListener('click',function(){
        if(element.required.classList.contains('clickcolor')){
          element.list.classList.add('flex')
        }else{
          utifunction.addClass(element.list,'flex')
        }
        element.required.classList.remove('clickcolor')
        element.exclude.classList.add('clickcolor')
      }),
      // 获取红球和篮球，点击后添加颜色
      clickball:function(){
        redballs = document.querySelectorAll('.redball')
        blueballs = document.querySelectorAll('.blueball')
        utifunction.addlis(redballs,'red','disabled')
        utifunction.addlis(blueballs,'blue','disabled')
      }
    }
   
    // 点击生成后，根据条件生成球
    let createball = {
      // 获取移除、选中的红蓝数组class条件
      sRedStr :'.redball.red',
      sBlueStr :'.blueball.blue',
      rRedStr : '.redball.disabled',
      rBlueStr : '.blueball.disabled',
      crate:element.rand.addEventListener('click',function(){
        // 声明所有数组
        let arr = []
        let redlistArr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33]
        let bluelistArr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
        // 获取必选和移除条件
        const saveRedArr = utifunction.getValue(createball.sRedStr)
        // console.log('sRedStr',saveRedArr)
        const saveBlueArr = utifunction.getValue(createball.sBlueStr)
        // console.log('sBlueStr',saveBlueArr)
        const removeRedArr = utifunction.getValue(createball.rRedStr)
        // console.log('removeRedArr',removeRedArr)
        const removeblueArr = utifunction.getValue(createball.rBlueStr)
        // console.log('removeRedArr',removeblueArr)
        // 移除所有条件
        utifunction.wipeoff(redlistArr,saveRedArr)
        utifunction.wipeoff(redlistArr,removeRedArr)
        utifunction.wipeoff(bluelistArr,saveBlueArr)
        utifunction.wipeoff(bluelistArr,removeblueArr)
        // 声明装球的两个数组
        let redArr = saveRedArr
        let BlueArr = saveBlueArr
        // console.log(redlistArr,bluelistArr)
        // 根据条件选出红球
        while(redArr.length > 6){
          let redNum = utifunction.getRandom(0,redArr.length-1)
          redArr.splice(redNum,1)
        }
        while (redArr.length < 6){
          let redNum = utifunction.getRandom(0,redlistArr.length-1)
          redArr.push(redlistArr[redNum])
          redlistArr.splice(redNum,1)
        }
        // 红球排序,存入渲染组数
        redArr.sort(function(a,b){
          return a - b
        })
        arr = redArr
        // 根据条件选出蓝球
        while(BlueArr.length > 1){
          let blelen = BlueArr.length
          let bleNum = utifunction.getRandom(0,blelen-1)
          BlueArr.splice(bleNum,1)
        }
        if(BlueArr.length < 1){
        let blelen = bluelistArr.length
        let bleNum = utifunction.getRandom(0,blelen-1)
        BlueArr.push(bluelistArr[bleNum])
        }
        arr.push(BlueArr[0])
        initpage.randarr.push(arr)
        utifunction.randBall(initpage.randarr)
      })
    }
    // 删除生成球
    let delball = {
      delball : element.result.addEventListener('click',function(e){
      // console.log(e.target.tagName)
        if (e.target.tagName === 'SPAN'){
          initpage.randarr.splice(e.target.dataset.value,1)
        }
        utifunction.randBall(initpage.randarr)
      })
    }
    // 保存生成数据导本地存储
    let data = {
      save:element.save.addEventListener('click',function(){
        // console.log(initpage.randarr)
        utifunction.showMessage('保存')
        // data.savelist = utifunction.saveball(initpage.randarr)
        // console.log(initpage.randarr)
        let savelist = initpage.randarr
        let jsonString = JSON.stringify(savelist);     
        localStorage.setItem('key1',jsonString)
        // a = localStorage.getItem('key1')
        // console.log(a)
      }) 
    }
    // 输入中奖号码
    let inprt = {
      arr : [0,0,0,0,0,0,0],
      // 展示输入中奖号码
      inprtWinning:element.inprtWinning.addEventListener('click',function(){
        element.input.classList.remove('none')
      }),
      cancelWinning:element.cancelWinning.addEventListener('click',function(){
        element.input.classList.add('none')
      }),
      // 录入中奖号码
      inputrednum:utifunction.listaddClass(element.ipnutredball,'red'),
      inputbluenum:utifunction.listaddClass(element.ipnutblueball,'blue'),
      //保存中奖号，规则红色不能超过6，蓝色不能超过1个
      saveWinning:element.saveWinning.addEventListener('click',function(){
        // 中奖号码收集
        inprt.arr = [0,0,0,0,0,0,0]
        // 获取输入的数字
        let inputred = utifunction.getValue('.b1.red')
        let inputblue = utifunction.getValue('.b2.blue')
        // 判断输入是否符合
        if(inputred.length > 6 && inputblue.length > 1 || inputred.length < 6 && inputblue.length < 1){
          utifunction.showMessage("红蓝球输入有误") 
        }else if(inputred.length > 6 || inputred.length < 6){
          utifunction.showMessage("红球输入有误")
        }else if(inputblue.length > 1 || inputblue.length < 1){
          utifunction.showMessage("蓝球输入有误")
        }else{
          utifunction.showMessage("输入成功")
          element.buyresult.classList.remove('none')
          element.input.classList.add('none')
          for(let i = 0; i <inputred.length;i++){
            inprt.arr[i] = inputred[i]
          }
          inprt.arr[6] = inputblue[0]
          // console.log(inprt.arr)
          let showarr = []
          showarr.push(inprt.arr)
          // console.log(localStorage.getItem('key2'))

          if(localStorage.getItem('key2') === null ){
            let jsonString = JSON.stringify(showarr);   
            localStorage.setItem('key2',jsonString)
          }else{
            let jsonString = localStorage.getItem('key2')
            let savelist = JSON.parse(jsonString)
            if(savelist.length < 5 ){
              savelist.push(inprt.arr)
              let jsonString2 = JSON.stringify(savelist); 
              localStorage.setItem('key2',jsonString2)
            }else{
              savelist.shift()
              savelist.push(inprt.arr)
              let jsonString2 = JSON.stringify(savelist); 
              localStorage.setItem('key2',jsonString2)
            }
          }
          utifunction.showin(element.nowin,showarr)
        }
      }),
      //显示历史中奖
      showWinning:element.showWinning.addEventListener('click',function(){
        if(localStorage.getItem('key2') !== null){
          element.buyresult.classList.remove('none')
          let jsonString = localStorage.getItem('key2')
          let savelist = JSON.parse(jsonString)
          utifunction.showoldwin(element.oldwin,savelist)
          utifunction.showMessage('显示历史中奖')
          element.input.classList.add('none')
        }
      })
     
    }
    let show = {
        //上期购买号码
      showPreResult:element.showPreResult.addEventListener('click',function(){
      utifunction.addClass(element.buyresult,'none')
      let jsonString = localStorage.getItem('key1')
      let savelist = JSON.parse(jsonString)
      utifunction.showball(element.buy,savelist)
      }),
       //判断命中
      confirm:element.confirm.addEventListener('click',function(){
        // console.log(inprt.arr)
        if(inprt.arr[0] === 0  ){
          utifunction.showMessage('未输入本期中奖号码')
        }
        // console.log(inprt.arr)
        rbal = inprt.arr.slice(0,5)
        blbal = inprt.arr[6]
        let r = document.querySelectorAll('.r')
        for(let i = 0 ; i < r.length; i ++){
          let getnum = Number(r[i].innerHTML)
          if(rbal.includes(getnum)){
            r[i].classList.add('red')
          }
        }
        let bl = document.querySelectorAll('.bl')
        for(let i = 0 ; i < bl.length; i ++){
          let getnum = Number(bl[i].innerHTML)
          if(blbal === getnum){
            bl[i].classList.add('blue')
          }
        }

        

      //   let jsonString = localStorage.getItem('key1')
      //   let savelist = JSON.parse(jsonString)
      //   function confirmball(elem,arr){
      //   const tempArr = arr.map(function (ele,index) {
      //     return `
      //     <div class="b">
      //       <span class="big-ball">${ele[0]}</span>
      //       <span class="big-ball">${ele[1]}</span>
      //       <span class="big-ball">${ele[2]}</span>
      //       <span class="big-ball">${ele[3]}</span>
      //       <span class="big-ball">${ele[4]}</span>
      //       <span class="big-ball">${ele[5]}</span>
      //       <span class="big-ball" style="margin-left:10px">${ele[6]}</span>
      //     </div>
      //     `
      //   })
      //   elem.innerHTML = tempArr.join('')
      // }
      })
    }
    // 调用初始化页面
    initpage.addball()
    initpage.clickball()

  </script>
</body>
</html>
